---
import Section from "../ui/Section.astro";
---

<Section
  id="contact"
  number="04"
  titleEs="Hablemos"
  titleEn="Let's talk"
  subtitleEs="Disponible para colaboraciones, consultoria u otros proyectos."
  subtitleEn="Open to collaborations, consulting, or IoT projects."
>
  <div class="grid gap-6">
    <div class="order-1 flex flex-col gap-4 sm:flex-row">
      <a
        href="https://github.com/joselaguilarhz"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center justify-between rounded-2xl border border-white/15 bg-white/5 px-5 py-4 text-sm text-zinc-200 transition hover:bg-white/10"
      >
        <span>GitHub</span>
        <svg
          aria-hidden="true"
          viewBox="0 0 24 24"
          class="h-5 w-5"
          fill="currentColor"
        >
          <path
            d="M12 2C6.48 2 2 6.58 2 12.24c0 4.52 2.87 8.36 6.84 9.72.5.1.68-.22.68-.48 0-.24-.01-.87-.01-1.7-2.78.62-3.37-1.38-3.37-1.38-.45-1.18-1.11-1.5-1.11-1.5-.91-.63.07-.62.07-.62 1 .07 1.53 1.07 1.53 1.07.9 1.59 2.36 1.13 2.94.86.09-.67.35-1.13.64-1.39-2.22-.26-4.56-1.14-4.56-5.07 0-1.12.39-2.04 1.03-2.76-.1-.26-.45-1.3.1-2.7 0 0 .84-.28 2.75 1.05a9.3 9.3 0 0 1 2.5-.35c.85 0 1.71.12 2.5.35 1.9-1.33 2.74-1.05 2.74-1.05.55 1.4.2 2.44.1 2.7.64.72 1.03 1.64 1.03 2.76 0 3.94-2.35 4.8-4.58 5.06.36.33.68.97.68 1.96 0 1.41-.01 2.55-.01 2.9 0 .27.18.59.69.49 3.96-1.36 6.82-5.2 6.82-9.71C22 6.58 17.52 2 12 2Z"
          />
        </svg>
      </a>
      <a
        href="https://www.linkedin.com/in/jose-luis-aguilar-sanchez-8a4270248"
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center justify-between rounded-2xl border border-white/15 bg-white/5 px-5 py-4 text-sm text-zinc-200 transition hover:bg-white/10"
      >
        <span>LinkedIn</span>
        <svg
          aria-hidden="true"
          viewBox="0 0 24 24"
          class="h-5 w-5"
          fill="currentColor"
        >
          <path
            d="M20.45 2H3.55A1.55 1.55 0 0 0 2 3.55v16.9A1.55 1.55 0 0 0 3.55 22h16.9A1.55 1.55 0 0 0 22 20.45V3.55A1.55 1.55 0 0 0 20.45 2ZM8.09 18.66H5.42V9.84h2.67Zm-1.33-9.98a1.55 1.55 0 1 1 0-3.1 1.55 1.55 0 0 1 0 3.1Zm11.9 9.98H15.99v-4.3c0-1.03-.02-2.36-1.44-2.36-1.44 0-1.66 1.12-1.66 2.28v4.38H10.2V9.84h2.56v1.2h.04c.36-.68 1.23-1.4 2.52-1.4 2.7 0 3.2 1.78 3.2 4.1Z"
          />
        </svg>
      </a>
    </div>

    <form
      data-contact-form
      class="order-2 w-full space-y-6 rounded-3xl border border-white/10 bg-white/5 p-6 shadow-[0_30px_120px_rgba(0,0,0,0.35)] md:p-8"
    >
      <div class="grid gap-4 md:grid-cols-2">
        <label class="space-y-2 text-xs uppercase tracking-[0.3em] text-zinc-400">
          <span data-lang="es">Nombre</span>
          <span data-lang="en">Name</span>
          <input
            type="text"
            name="from_name"
            required
            class="mt-2 w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm text-white placeholder:text-zinc-500 focus:border-white/40 focus:outline-none"
            data-placeholder-es="Nombre completo *"
            data-placeholder-en="Full name *"
          />
        </label>
        <label class="space-y-2 text-xs uppercase tracking-[0.3em] text-zinc-400">
          <span data-lang="es">Email</span>
          <span data-lang="en">Email</span>
          <input
            type="email"
            name="email_id"
            required
            class="mt-2 w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm text-white placeholder:text-zinc-500 focus:border-white/40 focus:outline-none"
            data-placeholder-es="DirecciÃ³n de email *"
            data-placeholder-en="Email address *"
          />
        </label>
      </div>

      <label class="space-y-2 text-xs uppercase tracking-[0.3em] text-zinc-400">
        <span data-lang="es">Asunto</span>
        <span data-lang="en">Subject</span>
        <input
          type="text"
          name="subject"
          class="mt-2 w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm text-white placeholder:text-zinc-500 focus:border-white/40 focus:outline-none"
          data-placeholder-es="Tema..."
          data-placeholder-en="Topic..."
        />
      </label>

      <label class="space-y-2 text-xs uppercase tracking-[0.3em] text-zinc-400">
        <span data-lang="es">Mensaje</span>
        <span data-lang="en">Message</span>
        <textarea
          name="message"
          required
          rows="6"
          class="mt-2 w-full rounded-2xl border border-white/10 bg-black/30 px-4 py-3 text-sm text-white placeholder:text-zinc-500 focus:border-white/40 focus:outline-none"
          data-placeholder-es="Tu mensaje..."
          data-placeholder-en="Your message..."
        ></textarea>
      </label>

      <div
        data-contact-status
        class="hidden rounded-2xl border border-transparent px-4 py-3 text-sm"
      ></div>

      <button
        type="submit"
        class="w-full rounded-2xl bg-white px-5 py-3 text-sm font-semibold text-zinc-900 transition hover:-translate-y-0.5 hover:bg-zinc-200"
      >
        <span data-lang="es">Enviar mensaje</span>
        <span data-lang="en">Send message</span>
      </button>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script is:inline>
    (() => {
      const form = document.querySelector("[data-contact-form]");
      if (!form) return;

      const status = document.querySelector("[data-contact-status]");
      const placeholders = form.querySelectorAll("[data-placeholder-es]");

      const setStatus = (type, message) => {
        if (!status) return;
        status.textContent = message;
        status.classList.remove(
          "hidden",
          "border-blue-400/30",
          "bg-blue-400/10",
          "text-blue-100",
          "border-red-400/30",
          "bg-red-400/10",
          "text-red-100",
          "border-emerald-400/30",
          "bg-emerald-400/10",
          "text-emerald-100"
        );
        if (type === "success") {
          status.classList.add("border-emerald-400/30", "bg-emerald-400/10", "text-emerald-100");
        } else if (type === "error") {
          status.classList.add("border-red-400/30", "bg-red-400/10", "text-red-100");
        } else {
          status.classList.add("border-blue-400/30", "bg-blue-400/10", "text-blue-100");
        }
      };

      const updatePlaceholders = () => {
        const lang = document.documentElement.getAttribute("data-lang") || "es";
        placeholders.forEach((input) => {
          input.setAttribute(
            "placeholder",
            lang === "en"
              ? input.getAttribute("data-placeholder-en")
              : input.getAttribute("data-placeholder-es")
          );
        });
      };

      updatePlaceholders();
      document.querySelectorAll("[data-lang-switch]").forEach((button) => {
        button.addEventListener("click", updatePlaceholders);
      });

      if (window.emailjs) {
        window.emailjs.init("y4fY_65hSZZUKBWwc");
      }

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        setStatus("info", "Enviando mensaje...");

        const formData = new FormData(form);
        const templateParams = {
          from_name: formData.get("from_name"),
          email_id: formData.get("email_id"),
          subject: formData.get("subject"),
          message: formData.get("message"),
          to_name: "Jose Luis",
          reply_to: formData.get("email_id"),
        };

        try {
          const response = await window.emailjs.send(
            "service_26nikh4",
            "template_4we8llh",
            templateParams,
            "y4fY_65hSZZUKBWwc"
          );

          if (response.status === 200) {
            setStatus(
              "success",
              "Mensaje enviado con exito. Me pondre en contacto contigo pronto."
            );
            form.reset();
          } else {
            throw new Error("Error en el envio");
          }
        } catch (error) {
          console.error("Error al enviar el email:", error);
          setStatus(
            "error",
            "Hubo un problema al enviar el mensaje. Intentalo de nuevo mas tarde o contactame por LinkedIn."
          );
        }
      });
    })();
  </script>
</Section>
